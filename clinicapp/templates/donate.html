<!-- templates/donate.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Donate</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<body>
    <h1>Make a Donation</h1>
    <form id="donation-form" method="post" action="{% url 'process_donation' %}">
        {% csrf_token %}
        <br>
        <label for="name">Full Name:</label>
        <input type="text" id="name" name="name" required>
        <br>
        <br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <br>
        <br>
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount" required>
        <br>
        <br>
        <label for="payment-method">Payment Method:</label>
        <select id="payment-method" name="payment_method" required>
            <option value="MPESA">M-Pesa</option>
            <option value="STRIPE">Stripe</option>
        </select>

        <button type="submit">Donate</button>
    </form>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
        document.getElementById('donation-form').addEventListener('submit', function (event) {
            event.preventDefault();
            const paymentMethod = document.getElementById('payment-method').value;
            if (paymentMethod === 'STRIPE') {
                // Initialize Stripe
                const stripe = Stripe('{{ stripe_public_key }}');
                fetch("{% url 'create_stripe_session' %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": "{{ csrf_token }}",
                    },
                    body: JSON.stringify({
                        amount: document.getElementById('amount').value,
                        name: document.getElementById('name').value,
                        email: document.getElementById('email').value,
                    }),
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.sessionId) {
                            return stripe.redirectToCheckout({ sessionId: data.sessionId });
                        } else {
                            alert('Error creating Stripe session.');
                        }
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                // For M-Pesa, submit the form normally
                this.submit();
            }
        });
    </script>
</body>

</html>